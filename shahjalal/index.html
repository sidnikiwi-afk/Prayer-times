<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shahjalal Islamic Society - Ramadhan 1447 Timetable</title>
    <meta name="description" content="Ramadan 1447 prayer timetable for Shahjalal Islamic Society, Bradford">
    <meta property="og:title" content="Ramadan 1447 Prayer Timetable">
    <meta property="og:description" content="Shahjalal Islamic Society, Bradford - Sehri, Iftar & prayer times with live countdown">
    <meta property="og:image" content="https://waqt.uk/shahjalal/og-image.svg">
    <meta property="og:url" content="https://waqt.uk/shahjalal/">
    <meta property="og:type" content="website">
    <meta name="theme-color" content="#004d40">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ramadan Times">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>游깿</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23004d40' width='100' height='100' rx='20'/><text x='50' y='50' text-anchor='middle' dominant-baseline='central' font-size='60'>游깿</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
            color: #1a1a1a;
            padding: 10px;
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            text-align: center;
            padding: 20px 15px;
            background: linear-gradient(135deg, #004d40 0%, #00796b 100%);
            color: white;
        }
        .mosque-icon {
            font-size: 50px;
            margin-bottom: 10px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
            display: none; /* replaced by SVG crescent */
        }
        h1 {
            font-size: clamp(18px, 5vw, 28px);
            font-weight: bold;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }
        .address {
            font-size: clamp(11px, 3vw, 14px);
            opacity: 0.9;
            margin-bottom: 8px;
        }
        .month-year {
            font-size: clamp(14px, 4vw, 18px);
            font-weight: 600;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            display: inline-block;
        }
        .moon-sighting {
            font-size: clamp(10px, 2.5vw, 12px);
            margin-top: 8px;
            opacity: 0.85;
            font-style: italic;
        }
        
        /* Countdown Section */
        .countdown-section {
            background: linear-gradient(135deg, #8b0000 0%, #c41e3a 100%);
            color: white;
            padding: 15px;
            text-align: center;
        }
        .countdown-section.pre-ramadan {
            background: linear-gradient(135deg, #004d40 0%, #00796b 100%);
        }
        .countdown-label {
            font-size: 14px;
            margin-bottom: 8px;
            opacity: 0.9;
        }
        .countdown-display {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .countdown-item {
            background: rgba(255,255,255,0.15);
            padding: 10px 15px;
            border-radius: 8px;
            min-width: 70px;
        }
        .countdown-value {
            font-size: clamp(24px, 6vw, 36px);
            font-weight: bold;
        }
        .countdown-unit {
            font-size: 11px;
            text-transform: uppercase;
            opacity: 0.8;
        }
        .next-prayer {
            margin-top: 10px;
            font-size: clamp(13px, 3.5vw, 16px);
            font-weight: 600;
            line-height: 1.6;
        }
        .next-prayer-time {
            background: rgba(255,255,255,0.2);
            padding: 3px 12px;
            border-radius: 15px;
            white-space: nowrap;
            display: inline-block;
        }

        /* Dua Section */
        .dua-section {
            display: flex;
            flex-wrap: wrap;
            font-size: 12px;
        }
        .dua-box {
            flex: 1 1 250px;
            text-align: center;
            padding: 15px 10px;
            color: white;
        }
        .dua-box.intention {
            background: #004d40;
        }
        .dua-box.completing {
            background: #8b0000;
        }
        .dua-title {
            font-style: italic;
            font-size: 11px;
            margin-bottom: 5px;
            opacity: 0.9;
        }
        .dua-arabic {
            font-size: 13px;
            margin-bottom: 3px;
            font-weight: 500;
        }
        .dua-translation {
            font-style: italic;
            font-size: 10px;
            opacity: 0.85;
        }

        /* Table Styles */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: clamp(10px, 2.5vw, 12px);
            min-width: 700px;
        }
        thead tr:first-child th {
            padding: 10px 4px;
            font-weight: 600;
            color: white;
        }
        .header-ramadan {
            background: #1a1a1a;
        }
        .header-beginning {
            background: #004d40;
        }
        .header-jamaah {
            background: #8b0000;
        }
        thead tr:nth-child(2) th {
            background: #f0f0f0;
            color: #1a1a1a;
            padding: 8px 4px;
            font-size: clamp(9px, 2vw, 11px);
            border: 1px solid #ccc;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        tbody tr {
            transition: all 0.3s ease;
        }
        tbody tr:nth-child(odd) {
            background: #fafafa;
        }
        tbody tr:nth-child(even) {
            background: white;
        }
        tbody tr:hover {
            background: #e0f2f1 !important;
        }
        td {
            padding: 8px 4px;
            text-align: center;
            border: 1px solid #ddd;
        }
        .date-col {
            font-weight: 600;
        }
        .friday {
            background: #ffe6e6 !important;
        }
        .friday:hover {
            background: #ffcccc !important;
        }
        .friday .day-col {
            color: #8b0000;
            font-weight: bold;
        }
        .sehri-col {
            color: #8b0000;
            font-weight: bold;
        }
        .iftari-col {
            font-weight: bold;
            color: #004d40;
        }
        
        /* Last 10 nights - Laylatul Qadr */
        .last-ten {
            border-left: 3px solid #ffc107;
        }
        .last-ten .no-col {
            color: #b8860b;
            font-weight: bold;
        }
        .last-ten-badge {
            display: inline-block;
            background: #ffc107;
            color: #1a1a1a;
            font-size: 7px;
            padding: 1px 4px;
            border-radius: 8px;
            margin-left: 3px;
            font-weight: bold;
            vertical-align: middle;
        }
        .odd-night {
            border-left: 3px solid #ff8c00;
        }
        .odd-night .no-col {
            color: #ff8c00;
            font-weight: bold;
        }

        /* Today's row highlighting */
        .today {
            background: linear-gradient(90deg, #fff3cd 0%, #ffeeba 100%) !important;
            box-shadow: inset 0 0 0 2px #ffc107;
            animation: pulse 2s infinite;
        }
        .today td {
            border-color: #ffc107;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.85; }
        }
        .today-badge {
            display: inline-block;
            background: #ffc107;
            color: #1a1a1a;
            font-size: 8px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
            font-weight: bold;
            vertical-align: middle;
        }

        /* Footer */
        .footer {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px;
            background: #f5f5f5;
        }
        .footer-section {
            flex: 1 1 200px;
            text-align: center;
            padding: 10px;
        }
        .eid-info {
            background: #004d40;
            color: white;
            border-radius: 8px;
        }
        .footer-section strong {
            color: #8b0000;
        }
        .eid-info strong {
            color: #ffc107;
        }
        .fitrana-box {
            background: white;
            border-radius: 8px;
            border: 2px solid #8b0000;
        }
        .contact-box {
            background: white;
            border-radius: 8px;
        }
        .contact-links {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
        }
        .contact-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 7px 16px;
            background: rgba(0, 77, 64, 0.08);
            border-radius: 20px;
            color: #004d40;
            text-decoration: none;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: all 0.2s ease;
        }
        .contact-link:hover {
            background: rgba(0, 77, 64, 0.15);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 77, 64, 0.15);
        }
        .contact-link svg {
            width: 14px;
            height: 14px;
            flex-shrink: 0;
        }

        /* Dark mode toggle */
        .dark-mode-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #004d40;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 18px;
            z-index: 100;
            transition: all 0.3s ease;
        }
        .dark-mode-toggle:hover {
            transform: scale(1.1);
        }
        .share-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: #25D366;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 18px;
            z-index: 100;
            transition: all 0.3s ease;
        }
        .share-btn:hover {
            transform: scale(1.1);
        }
        .notify-btn {
            position: fixed;
            bottom: 140px;
            right: 20px;
            background: #8b0000;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 18px;
            z-index: 100;
            transition: all 0.3s ease;
        }
        .notify-btn:hover {
            transform: scale(1.1);
        }
        .notify-btn.active {
            background: #004d40;
        }

        /* Dark mode styles */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        body.dark-mode .container {
            background: #1f1f1f;
            color: #e0e0e0;
        }
        body.dark-mode thead tr:nth-child(2) th {
            background: #2d2d2d;
            color: #e0e0e0;
            border-color: #444;
        }
        body.dark-mode tbody tr:nth-child(odd) {
            background: #252525;
        }
        body.dark-mode tbody tr:nth-child(even) {
            background: #1f1f1f;
        }
        body.dark-mode tbody tr:hover {
            background: #1a3c3a !important;
        }
        body.dark-mode td {
            border-color: #444;
        }
        body.dark-mode .friday {
            background: #3d2525 !important;
        }
        body.dark-mode .today {
            background: linear-gradient(90deg, #3d3520 0%, #4a4025 100%) !important;
        }
        body.dark-mode .footer {
            background: #252525;
        }
        body.dark-mode .fitrana-box,
        body.dark-mode .contact-box {
            background: #2d2d2d;
            color: #e0e0e0;
        }
        body.dark-mode .contact-link {
            background: rgba(128, 203, 196, 0.12);
            color: #80cbc4;
        }
        body.dark-mode .contact-link:hover {
            background: rgba(128, 203, 196, 0.2);
            box-shadow: 0 2px 8px rgba(128, 203, 196, 0.15);
        }
        body.dark-mode .sehri-col {
            color: #ff6b6b;
        }
        body.dark-mode .iftari-col {
            color: #80cbc4;
        }
        body.dark-mode .last-ten-badge {
            background: #b8860b;
            color: white;
        }

        /* Demo mode controls */
        .demo-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #ff6b35;
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 14px;
            font-weight: bold;
            z-index: 100;
            transition: all 0.3s ease;
        }
        .demo-toggle:hover { transform: scale(1.1); }
        .demo-toggle.active { background: #e55a2b; }
        .demo-panel {
            display: none;
            position: fixed;
            bottom: 70px;
            left: 20px;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.25);
            z-index: 100;
            width: 300px;
            font-size: 13px;
        }
        .demo-panel.open { display: block; }
        .demo-panel h3 { margin: 0 0 10px; font-size: 14px; color: #ff6b35; }
        .demo-panel label { display: block; font-weight: 600; margin: 8px 0 4px; color: #333; }
        .demo-panel select, .demo-panel input[type="range"] { width: 100%; }
        .demo-panel select { padding: 6px; border-radius: 6px; border: 1px solid #ccc; }
        .demo-time-display {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: #ff6b35;
            margin: 5px 0;
            font-family: monospace;
        }
        .demo-reset {
            width: 100%;
            margin-top: 10px;
            padding: 8px;
            background: #ff6b35;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }
        .demo-reset:hover { background: #e55a2b; }
        .demo-badge {
            display: inline-block;
            background: #ff6b35;
            color: white;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
            font-weight: bold;
            vertical-align: middle;
            animation: pulse 2s infinite;
        }
        body.dark-mode .demo-panel { background: #2d2d2d; color: #e0e0e0; }
        body.dark-mode .demo-panel h3 { color: #ff6b35; }
        body.dark-mode .demo-panel label { color: #ccc; }
        body.dark-mode .demo-panel select { background: #1f1f1f; color: #e0e0e0; border-color: #555; }

        /* View Toggle */
        .view-toggle {
            display: flex;
            justify-content: center;
            padding: 12px 15px;
            background: #f5f5f5;
        }
        .view-btn {
            padding: 8px 24px;
            border: 2px solid #004d40;
            background: transparent;
            color: #004d40;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.25s ease;
            letter-spacing: 0.5px;
        }
        .view-btn:first-child { border-radius: 20px 0 0 20px; border-right: none; }
        .view-btn:last-child { border-radius: 0 20px 20px 0; }
        .view-btn.active {
            background: #004d40;
            color: white;
        }
        body.dark-mode .view-toggle { background: #252525; }
        body.dark-mode .view-btn { border-color: #80cbc4; color: #80cbc4; }
        body.dark-mode .view-btn.active { background: #80cbc4; color: #1a1a1a; }

        /* Today View */
        .today-view { padding: 15px; }
        .today-date-bar {
            text-align: center;
            padding: 10px;
            font-size: 14px;
            font-weight: 600;
            color: #004d40;
            border-bottom: 1px solid #eee;
            margin-bottom: 12px;
        }
        .today-cards { display: flex; flex-direction: column; gap: 10px; }
        .prayer-card {
            border-radius: 10px;
            padding: 14px 16px;
            background: #fafafa;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        .prayer-card.passed { opacity: 0.45; }
        .prayer-card.passed .prayer-card-name::after { content: ' \2713'; color: #004d40; }
        .prayer-card.active-prayer {
            border-color: #004d40;
            background: linear-gradient(135deg, #e0f2f1, #b2dfdb);
            box-shadow: 0 2px 12px rgba(0,77,64,0.15);
        }
        .prayer-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .prayer-card-name {
            font-size: 15px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .prayer-card-time {
            font-size: 22px;
            font-weight: 700;
            color: #004d40;
        }
        .prayer-card-details {
            display: flex;
            gap: 20px;
            margin-top: 6px;
            font-size: 12px;
            color: #666;
        }
        .prayer-card-detail strong { color: #333; }
        .next-badge {
            display: inline-block;
            background: #004d40;
            color: white;
            font-size: 9px;
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-left: 8px;
            vertical-align: middle;
            animation: pulse 2s infinite;
        }
        .today-tomorrow {
            margin-top: 15px;
            text-align: center;
            padding: 12px;
            background: linear-gradient(135deg, #004d40, #00796b);
            color: white;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
        }
        body.dark-mode .today-date-bar { color: #80cbc4; border-bottom-color: #444; }
        body.dark-mode .prayer-card { background: #252525; }
        body.dark-mode .prayer-card.active-prayer { background: linear-gradient(135deg, #1a3c3a, #1f4a47); border-color: #80cbc4; }
        body.dark-mode .prayer-card-time { color: #80cbc4; }
        body.dark-mode .prayer-card-details { color: #999; }
        body.dark-mode .prayer-card-detail strong { color: #ccc; }
        body.dark-mode .next-badge { background: #80cbc4; color: #1a1a1a; }
        body.dark-mode .prayer-card.passed .prayer-card-name::after { color: #80cbc4; }

        @media (min-width: 600px) {
            .today-view { padding: 20px 30px; }
            .prayer-card-name { font-size: 17px; }
            .prayer-card-time { font-size: 26px; }
        }

        /* Print styles */
        @media print {
            body {
                background: white !important;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
            .dark-mode-toggle,
            .share-btn,
            .notify-btn,
            .qibla-btn,
            .qibla-overlay,
            .countdown-section,
            .demo-toggle,
            .demo-panel,
            .home-btn,
            .view-toggle,
            .today-view,
            .ramadan-progress {
                display: none !important;
            }
            .today {
                background: #fff3cd !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            #shaderCanvas, #starCanvas { display: none !important; }
            .header { animation: none !important; }
            .header::after { display: none !important; }
            .mosque-icon-svg { animation: none !important; filter: none !important; }
            .prayer-card,
            .countdown-item,
            .footer-section { animation: none !important; }
            * { backdrop-filter: none !important; -webkit-backdrop-filter: none !important; }
            tbody tr { transition: none !important; border-left: none !important; }
        }

        /* Mobile optimizations */
        @media (max-width: 600px) {
            .countdown-item {
                min-width: 60px;
                padding: 8px 10px;
            }
            .footer-section {
                flex: 1 1 100%;
            }
        }

        /* === VISUAL ENHANCEMENTS === */

        /* 1a. Header with Granim canvas + geometric overlay */
        .header {
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        .header > * { position: relative; z-index: 2; }
        /* Islamic geometric pattern overlay */
        .header::after {
            content: '';
            position: absolute;
            inset: 0;
            z-index: 1;
            opacity: 0.06;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Cg fill='%23ffffff' fill-opacity='1'%3E%3Cpath d='M40 0l8 20h22l-18 13 7 21-19-14-19 14 7-21L10 20h22zM40 44l4 10h11l-9 7 3 10-9-7-9 7 3-10-9-7h11z'/%3E%3C/g%3E%3C/svg%3E");
            background-size: 80px 80px;
        }
        body.dark-mode .header::after {
            opacity: 0.04;
        }

        /* 1b. Enhanced Prayer Cards */
        .prayer-card {
            background: rgba(250, 250, 250, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-left: 3px solid #b2dfdb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        .prayer-card:not(.passed):not(.active-prayer) {
            border-left-color: #80cbc4;
        }
        .prayer-card.passed {
            border-left-color: #ccc;
        }
        .prayer-card.active-prayer {
            border-left: 4px solid #004d40;
            box-shadow: 0 0 24px rgba(0, 77, 64, 0.25), 0 4px 16px rgba(0, 77, 64, 0.12);
            transform: scale(1.015);
        }
        body.dark-mode .prayer-card {
            background: rgba(37, 37, 37, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-left: 3px solid #37474f;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        body.dark-mode .prayer-card:not(.passed):not(.active-prayer) {
            border-left-color: #4db6ac;
        }
        body.dark-mode .prayer-card.passed {
            border-left-color: #555;
        }
        body.dark-mode .prayer-card.active-prayer {
            border-left: 4px solid #80cbc4;
            box-shadow: 0 0 24px rgba(128, 203, 196, 0.2), 0 4px 16px rgba(128, 203, 196, 0.1);
        }

        /* 1c. Entrance Animations */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        .countdown-item {
            animation: slideUp 0.5s ease-out both;
        }
        .countdown-item:nth-child(1) { animation-delay: 0.05s; }
        .countdown-item:nth-child(2) { animation-delay: 0.1s; }
        .countdown-item:nth-child(3) { animation-delay: 0.15s; }
        .countdown-item:nth-child(4) { animation-delay: 0.2s; }
        .prayer-card {
            animation: slideUp 0.4s ease-out both;
        }
        .prayer-card:nth-child(1) { animation-delay: 0.05s; }
        .prayer-card:nth-child(2) { animation-delay: 0.1s; }
        .prayer-card:nth-child(3) { animation-delay: 0.15s; }
        .prayer-card:nth-child(4) { animation-delay: 0.2s; }
        .prayer-card:nth-child(5) { animation-delay: 0.25s; }
        .prayer-card:nth-child(6) { animation-delay: 0.3s; }
        .footer-section {
            animation: slideUp 0.5s ease-out both;
        }
        .footer-section:nth-child(1) { animation-delay: 0.1s; }
        .footer-section:nth-child(2) { animation-delay: 0.15s; }
        .footer-section:nth-child(3) { animation-delay: 0.2s; }

        @media (prefers-reduced-motion: reduce) {
            .countdown-item,
            .prayer-card,
            .footer-section {
                animation: none !important;
            }
            .header {
                animation: none !important;
            }
            .mosque-icon-svg {
                animation: none !important;
            }
            .mosque-icon-svg path[opacity="0.4"],
            .mosque-icon-svg path[opacity="0.5"] {
                animation: none !important;
            }
            .countdown-value {
                transition: none !important;
            }
            tbody tr {
                transition: none !important;
            }
            #shaderCanvas, #starCanvas {
                display: none !important;
            }
        }

        /* 1d. Enhanced Countdown Numbers */
        .countdown-value {
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.4), 0 0 40px rgba(255, 255, 255, 0.15);
            transition: transform 0.2s ease;
        }
        .countdown-value.tick {
            transform: scale(1.18);
            text-shadow: 0 0 25px rgba(255, 255, 255, 0.6), 0 0 50px rgba(255, 255, 255, 0.25);
        }
        .countdown-item {
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        /* 1e. Polished Table Hover */
        tbody tr {
            transition: all 0.25s ease;
            border-left: 3px solid transparent;
        }
        tbody tr:hover {
            transform: translateX(2px);
            border-left-color: #004d40;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        body.dark-mode tbody tr:hover {
            border-left-color: #80cbc4;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* Home button */
        .home-btn {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 77, 64, 0.9);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 10px 22px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            font-size: 13px;
            font-weight: 600;
            z-index: 100;
            transition: all 0.3s ease;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 7px;
            letter-spacing: 0.5px;
        }
        .home-btn:hover {
            background: rgba(0, 77, 64, 1);
            transform: translateX(-50%) translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 77, 64, 0.3);
        }
        .home-btn svg { width: 16px; height: 16px; flex-shrink: 0; }
        body.dark-mode .home-btn {
            background: rgba(0, 77, 64, 0.7);
            border-color: rgba(128, 203, 196, 0.2);
        }
        body.dark-mode .home-btn:hover {
            background: rgba(0, 77, 64, 0.9);
            box-shadow: 0 6px 25px rgba(128, 203, 196, 0.2);
        }

        /* 1f. Floating Button Glass Effect */
        .dark-mode-toggle,
        .share-btn,
        .notify-btn {
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        .dark-mode-toggle {
            background: rgba(0, 77, 64, 0.85);
        }
        .share-btn {
            background: rgba(37, 211, 102, 0.85);
        }
        .notify-btn {
            background: rgba(139, 0, 0, 0.85);
        }
        .notify-btn.active {
            background: rgba(0, 77, 64, 0.85);
        }

        /* 1g. View Toggle Transition */
        .today-view,
        .table-container {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .view-fade-enter {
            opacity: 0;
            transform: translateY(8px);
        }

        /* Granim canvas behind header */
        #shaderCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* SVG crescent moon icon */
        .mosque-icon-svg {
            width: 54px;
            height: 54px;
            margin: 0 auto 10px;
            filter: drop-shadow(0 2px 8px rgba(255, 193, 7, 0.4));
            animation: moonGlow 3s ease-in-out infinite alternate;
        }
        @keyframes moonGlow {
            from { filter: drop-shadow(0 2px 8px rgba(255, 193, 7, 0.3)); }
            to   { filter: drop-shadow(0 2px 16px rgba(255, 193, 7, 0.6)); }
        }

        /* Star field in countdown */
        .countdown-section {
            position: relative;
            overflow: hidden;
        }
        #starCanvas {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.6;
        }

        /* === Feature 1: Countdown Flip Animation === */
        .flip-digit {
            display: inline-block;
            perspective: 200px;
            transition: transform 0.25s ease;
        }
        .flip-digit.flipping {
            animation: flipDigit 0.35s ease-out;
        }
        @keyframes flipDigit {
            0%   { transform: rotateX(0deg) scale(1); }
            40%  { transform: rotateX(-90deg) scale(0.95); }
            70%  { transform: rotateX(10deg) scale(1.02); }
            100% { transform: rotateX(0deg) scale(1); }
        }

        /* === Feature 2: Animated Mosque SVG Icon === */
        .mosque-icon-svg path[opacity="0.4"] {
            animation: windowGlow04 3s ease-in-out infinite;
        }
        .mosque-icon-svg path[opacity="0.5"] {
            animation: windowGlow05 3s ease-in-out infinite;
        }
        @keyframes windowGlow04 {
            0%, 100% { opacity: 0.4; }
            50%      { opacity: 0.7; }
        }
        @keyframes windowGlow05 {
            0%, 100% { opacity: 0.5; }
            50%      { opacity: 0.8; }
        }
        .mosque-icon-svg {
            animation: moonGlow 3s ease-in-out infinite alternate, mosqueFloat 4s ease-in-out infinite;
        }
        @keyframes mosqueFloat {
            0%, 100% { transform: translateY(0); }
            50%      { transform: translateY(-3px); }
        }

        /* === Feature 4: Ramadan Progress Bar === */
        .ramadan-progress {
            position: relative;
            width: 100%;
            height: 20px;
            background: rgba(0, 77, 64, 0.1);
            display: none;
        }
        .ramadan-progress.visible { display: block; }
        .progress-fill {
            height: 100%;
            border-radius: 0 3px 3px 0;
            background: linear-gradient(90deg, #004d40, #00796b, #4db6ac);
            transition: width 0.6s ease;
            min-width: 2px;
        }
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10px;
            font-weight: 600;
            color: white;
            white-space: nowrap;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            letter-spacing: 0.5px;
        }
        body.dark-mode .ramadan-progress {
            background: rgba(128, 203, 196, 0.1);
        }
        body.dark-mode .progress-fill {
            background: linear-gradient(90deg, #004d40, #00796b, #80cbc4);
        }
        body.dark-mode .progress-text {
            color: #e0e0e0;
            text-shadow: 0 1px 3px rgba(0,0,0,0.7);
        }

        /* === Feature 7: Qibla Compass === */
        .qibla-btn {
            position: fixed;
            bottom: 80px;
            left: 20px;
            background: rgba(0, 77, 64, 0.85);
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-size: 18px;
            z-index: 100;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        .qibla-btn:hover { transform: scale(1.1); }
        .qibla-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }
        .qibla-overlay.open { display: flex; }
        .qibla-compass {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 320px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            position: relative;
        }
        .qibla-compass h3 {
            color: #004d40;
            margin: 0 0 5px;
            font-size: 18px;
        }
        .qibla-compass .qibla-subtitle {
            color: #666;
            font-size: 12px;
            margin-bottom: 20px;
        }
        .qibla-compass-ring {
            width: 200px;
            height: 200px;
            margin: 0 auto 15px;
            position: relative;
            border-radius: 50%;
            border: 3px solid #e0f2f1;
            background: radial-gradient(circle, #f5f5f5 0%, #e0f2f1 100%);
        }
        .qibla-compass-ring svg {
            width: 100%;
            height: 100%;
        }
        .qibla-bearing-text {
            font-size: 14px;
            color: #333;
            font-weight: 600;
        }
        .qibla-close {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 22px;
            cursor: pointer;
            color: #999;
            line-height: 1;
        }
        .qibla-close:hover { color: #333; }
        body.dark-mode .qibla-compass {
            background: #2d2d2d;
            color: #e0e0e0;
        }
        body.dark-mode .qibla-compass h3 { color: #80cbc4; }
        body.dark-mode .qibla-compass .qibla-subtitle { color: #999; }
        body.dark-mode .qibla-compass-ring {
            border-color: #37474f;
            background: radial-gradient(circle, #1f1f1f 0%, #263238 100%);
        }
        body.dark-mode .qibla-bearing-text { color: #ccc; }
        body.dark-mode .qibla-close { color: #777; }
        body.dark-mode .qibla-close:hover { color: #ccc; }

        /* === Feature 8: Custom Themed Scrollbar === */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #e0f2f1; }
        ::-webkit-scrollbar-thumb { background: #00796b; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #004d40; }
        body.dark-mode::-webkit-scrollbar-track { background: #1a1a2e; }
        body.dark-mode::-webkit-scrollbar-thumb { background: #00796b; }
        html {
            scrollbar-color: #00796b #e0f2f1;
            scrollbar-width: thin;
        }

        /* === Feature 9: Skeleton Shimmer for Granim === */
        .header.shimmer::before {
            content: '';
            position: absolute;
            inset: 0;
            z-index: 1;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.08) 50%, transparent 100%);
            background-size: 200% 100%;
            animation: shimmerMove 1.5s linear infinite;
            pointer-events: none;
        }
        @keyframes shimmerMove {
            0%   { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Print: hide new interactive elements */
        @media print {
            .ramadan-progress,
            .qibla-btn,
            .qibla-overlay {
                display: none !important;
            }
        }

        /* Reduced motion: disable new animations */
        @media (prefers-reduced-motion: reduce) {
            .flip-digit { animation: none !important; }
            .flip-digit.flipping { animation: none !important; }
            .mosque-icon-svg path[opacity="0.4"],
            .mosque-icon-svg path[opacity="0.5"] { animation: none !important; }
            .mosque-icon-svg { animation: none !important; }
            .progress-fill { transition: none !important; }
            .header.shimmer::before { animation: none !important; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header shimmer">
            <canvas id="shaderCanvas"></canvas>
            <div class="mosque-icon-svg">
                <svg viewBox="0 0 120 100" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="mosqueGrad" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" stop-color="#ffd54f"/>
                            <stop offset="100%" stop-color="#ffb300"/>
                        </linearGradient>
                    </defs>
                    <!-- Left minaret -->
                    <rect x="15" y="30" width="8" height="52" rx="1" fill="url(#mosqueGrad)" opacity="0.8"/>
                    <path d="M14 30 L19 18 L24 30" fill="url(#mosqueGrad)" opacity="0.9"/>
                    <circle cx="19" cy="15" r="2.5" fill="#ffd54f"/>
                    <line x1="19" y1="12.5" x2="19" y2="8" stroke="#ffd54f" stroke-width="1"/>
                    <path d="M17 8 L19 4 L21 8" fill="#ffd54f"/>
                    <!-- Right minaret -->
                    <rect x="97" y="30" width="8" height="52" rx="1" fill="url(#mosqueGrad)" opacity="0.8"/>
                    <path d="M96 30 L101 18 L106 30" fill="url(#mosqueGrad)" opacity="0.9"/>
                    <circle cx="101" cy="15" r="2.5" fill="#ffd54f"/>
                    <line x1="101" y1="12.5" x2="101" y2="8" stroke="#ffd54f" stroke-width="1"/>
                    <path d="M99 8 L101 4 L103 8" fill="#ffd54f"/>
                    <!-- Main body -->
                    <rect x="28" y="50" width="64" height="32" rx="2" fill="url(#mosqueGrad)" opacity="0.7"/>
                    <!-- Large central dome -->
                    <ellipse cx="60" cy="50" rx="28" ry="22" fill="url(#mosqueGrad)" opacity="0.85"/>
                    <!-- Dome crescent finial -->
                    <line x1="60" y1="28" x2="60" y2="20" stroke="#ffd54f" stroke-width="1.2"/>
                    <circle cx="60" cy="18" r="3" fill="#ffd54f"/>
                    <circle cx="61.5" cy="17" r="2" fill="#004d40"/>
                    <!-- Arched windows -->
                    <path d="M42 72 L42 64 Q47 58 52 64 L52 72 Z" fill="#004d40" opacity="0.4"/>
                    <path d="M55 72 L55 62 Q60 54 65 62 L65 72 Z" fill="#004d40" opacity="0.5"/>
                    <path d="M68 72 L68 64 Q73 58 78 64 L78 72 Z" fill="#004d40" opacity="0.4"/>
                    <!-- Base -->
                    <rect x="25" y="82" width="70" height="4" rx="1" fill="url(#mosqueGrad)" opacity="0.6"/>
                </svg>
            </div>
            <h1>SHAHJALAL ISLAMIC SOCIETY</h1>
            <div class="address">149A Little Horton Lane, Bradford, West Yorkshire, BD5 0HS</div>
            <div class="month-year">RAMADHN 1447 | FEBRUARY 2026</div>
            <div class="moon-sighting">Dates are subject to moon sighting confirmation</div>
        </div>

        <div class="ramadan-progress" id="ramadanProgress">
            <div class="progress-fill" id="progressFill"></div>
            <span class="progress-text" id="progressText"></span>
        </div>

        <div class="countdown-section" id="countdownSection">
            <canvas id="starCanvas"></canvas>
            <div class="countdown-label" id="countdownLabel">Time until Iftar</div>
            <div class="countdown-display">
                <div class="countdown-item" id="daysContainer" style="display: none;">
                    <div class="countdown-value" id="days">--</div>
                    <div class="countdown-unit">Days</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-value" id="hours">--</div>
                    <div class="countdown-unit">Hours</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-value" id="minutes">--</div>
                    <div class="countdown-unit">Minutes</div>
                </div>
                <div class="countdown-item">
                    <div class="countdown-value" id="seconds">--</div>
                    <div class="countdown-unit">Seconds</div>
                </div>
            </div>
            <div class="next-prayer" id="nextPrayer"></div>
        </div>

        <div class="dua-section">
            <div class="dua-box intention">
                <div class="dua-title">Intention for fasting</div>
                <div class="dua-arabic">Wa bisawmi ghadin nawaytu min shahri Ramadh캐n</div>
                <div class="dua-translation">"I intend to keep the fast tomorrow in the month of Ramadh캐n."</div>
            </div>
            <div class="dua-box completing">
                <div class="dua-title">Completing the Fast Du'캐</div>
                <div class="dua-arabic">All캐humma laka sumtu wa 'ala rizqika aftartu</div>
                <div class="dua-translation">"O All캐h! For You I have fasted and by what (food) You have blessed me with, have I broken it."</div>
            </div>
        </div>

        <div class="view-toggle" id="viewToggle">
            <button class="view-btn active" data-view="today">Today</button>
            <button class="view-btn" data-view="full">Full Timetable</button>
        </div>

        <div class="today-view" id="todayView" style="display: none;">
            <div class="today-date-bar" id="todayDateBar"></div>
            <div class="today-cards" id="todayCards"></div>
            <div class="today-tomorrow" id="todayTomorrow"></div>
        </div>

        <div class="table-container" id="tableContainer">
            <table id="timetable">
                <thead>
                    <tr>
                        <th colspan="4" class="header-ramadan">RAMADHN</th>
                        <th colspan="5" class="header-beginning">BEGINNING TIME</th>
                        <th colspan="5" class="header-jamaah">JAM'AH TIME</th>
                    </tr>
                    <tr>
                        <th>Date</th>
                        <th>Day</th>
                        <th>No</th>
                        <th>Sehri</th>
                        <th>Fajr</th>
                        <th>Sunrise</th>
                        <th>Zuhr</th>
                        <th>Asr</th>
                        <th>Isha</th>
                        <th>Fajr</th>
                        <th>Zuhr</th>
                        <th>Asr</th>
                        <th>Maghrib</th>
                        <th>Isha</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>

        <div class="footer">
            <div class="footer-section eid-info">
                <strong>Two Eid Sal캐h Will Be Held:</strong><br>
                1st Jam캐'ah at 6:24am | 2nd Jam캐'ah at 9:00am
            </div>
            <div class="footer-section fitrana-box">
                <strong>FITRANA:</strong><br>
                춲5.00 PER PERSON
            </div>
            <div class="footer-section contact-box">
                <em>Late night jam캐'ah will be held.</em>
                <div class="contact-links">
                    <a href="tel:07903582141" class="contact-link"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>07903 582141</a>
                    <a href="tel:07867607330" class="contact-link"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>07867 607330</a>
                </div>
            </div>
        </div>

        <div style="background: #1a1a2e; padding: 10px 15px; text-align: center; font-size: 12px;">
            <a href="https://forms.gle/W6W57QjbAgz8CzYn9" target="_blank" style="color: rgba(255,255,255,0.5); text-decoration: none; margin: 0 10px; transition: color 0.2s;" onmouseover="this.style.color='white'" onmouseout="this.style.color='rgba(255,255,255,0.5)'">&#x1F4CB; Submit a Timetable</a>
            <span style="color: rgba(255,255,255,0.15);">|</span>
            <a href="https://forms.gle/W6W57QjbAgz8CzYn9" target="_blank" style="color: rgba(255,255,255,0.5); text-decoration: none; margin: 0 10px; transition: color 0.2s;" onmouseover="this.style.color='white'" onmouseout="this.style.color='rgba(255,255,255,0.5)'">&#x26A0;&#xFE0F; Report an Error</a>
        </div>
    </div>

    <button class="demo-toggle" id="demoToggle" onclick="toggleDemoPanel()" title="Demo mode">DEMO</button>
    <div class="demo-panel" id="demoPanel">
        <h3>Demo Mode</h3>
        <label for="demoDate">Date</label>
        <select id="demoDate" onchange="onDemoDateChange()"></select>
        <label for="demoTime">Time of Day</label>
        <input type="range" id="demoTime" min="0" max="1439" value="720" oninput="onDemoTimeChange()">
        <div class="demo-time-display" id="demoTimeDisplay">12:00</div>
        <button class="demo-reset" onclick="resetDemo()">Reset to Live</button>
    </div>

    <button class="notify-btn" id="notifyBtn" onclick="toggleNotifications()" title="Enable Sehri/Iftar reminders">游댒</button>
    <button class="share-btn" onclick="shareWhatsApp()" title="Share on WhatsApp">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
    </button>
    <a href="../" class="home-btn" title="All mosques"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>Home</a>
    <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle dark mode">游깿</button>

    <button class="qibla-btn" id="qiblaBtn" onclick="openQibla()" title="Qibla direction">游빐</button>
    <div class="qibla-overlay" id="qiblaOverlay" onclick="closeQiblaOverlay(event)">
        <div class="qibla-compass" onclick="event.stopPropagation()">
            <button class="qibla-close" onclick="closeQibla()">&times;</button>
            <h3>Qibla Direction</h3>
            <div class="qibla-subtitle">From Bradford, UK</div>
            <div class="qibla-compass-ring" id="qiblaRing">
                <svg viewBox="0 0 200 200" id="qiblaSvg">
                    <!-- Compass rose -->
                    <circle cx="100" cy="100" r="95" fill="none" stroke="#b2dfdb" stroke-width="1"/>
                    <circle cx="100" cy="100" r="70" fill="none" stroke="#e0e0e0" stroke-width="0.5"/>
                    <!-- Cardinal labels -->
                    <text x="100" y="18" text-anchor="middle" font-size="12" font-weight="bold" fill="#004d40">N</text>
                    <text x="188" y="104" text-anchor="middle" font-size="11" fill="#888">E</text>
                    <text x="100" y="194" text-anchor="middle" font-size="11" fill="#888">S</text>
                    <text x="14" y="104" text-anchor="middle" font-size="11" fill="#888">W</text>
                    <!-- Tick marks -->
                    <line x1="100" y1="8" x2="100" y2="16" stroke="#004d40" stroke-width="2"/>
                    <line x1="192" y1="100" x2="184" y2="100" stroke="#ccc" stroke-width="1"/>
                    <line x1="100" y1="192" x2="100" y2="184" stroke="#ccc" stroke-width="1"/>
                    <line x1="8" y1="100" x2="16" y2="100" stroke="#ccc" stroke-width="1"/>
                    <!-- Qibla arrow (119.7 degrees from north) -->
                    <g id="qiblaArrow" transform="rotate(119.7, 100, 100)">
                        <line x1="100" y1="100" x2="100" y2="25" stroke="#8b0000" stroke-width="2.5" stroke-linecap="round"/>
                        <polygon points="100,20 94,36 106,36" fill="#8b0000"/>
                        <circle cx="100" cy="100" r="5" fill="#004d40"/>
                        <circle cx="100" cy="100" r="2" fill="white"/>
                    </g>
                    <!-- Kaaba icon at arrow tip -->
                    <g id="qiblaKaaba" transform="rotate(119.7, 100, 100)">
                        <rect x="95" y="12" width="10" height="10" rx="1" fill="#1a1a1a" transform="rotate(-119.7, 100, 17)"/>
                    </g>
                </svg>
            </div>
            <div class="qibla-bearing-text" id="qiblaBearingText">Qibla is 119.7&deg; from North (ESE)</div>
        </div>
    </div>

    <script>
        // Timetable data with full dates (year, month, day)
        const timetableData = [
            // Pre-Ramadan February 2026
            { date: [2026, 2, 1], day: "Sun", no: "", sehri: "", fajr: "6:13", sunrise: "7:55", zuhr: "12:20", asr: "2:57", isha: "6:19", jFajr: "7:00", jZuhr: "1:00", jAsr: "3:30", maghrib: "4:52", jIsha: "6:30" },
            { date: [2026, 2, 2], day: "Mon", no: "", sehri: "", fajr: "6:11", sunrise: "7:53", zuhr: "12:21", asr: "2:59", isha: "6:21", jFajr: "7:00", jZuhr: "1:00", jAsr: "3:30", maghrib: "4:54", jIsha: "6:30" },
            { date: [2026, 2, 3], day: "Tue", no: "", sehri: "", fajr: "6:10", sunrise: "7:51", zuhr: "12:21", asr: "3:01", isha: "6:22", jFajr: "7:00", jZuhr: "1:00", jAsr: "3:30", maghrib: "4:56", jIsha: "6:30" },
            { date: [2026, 2, 4], day: "Wed", no: "", sehri: "", fajr: "6:09", sunrise: "7:49", zuhr: "12:21", asr: "3:03", isha: "6:24", jFajr: "7:00", jZuhr: "1:00", jAsr: "3:30", maghrib: "4:58", jIsha: "6:30" },
            { date: [2026, 2, 5], day: "Thu", no: "", sehri: "", fajr: "6:07", sunrise: "7:48", zuhr: "12:21", asr: "3:05", isha: "6:26", jFajr: "7:00", jZuhr: "1:00", jAsr: "3:30", maghrib: "5:00", jIsha: "6:30" },
            { date: [2026, 2, 6], day: "Fri", no: "", sehri: "", fajr: "6:05", sunrise: "7:46", zuhr: "12:21", asr: "3:07", isha: "6:28", jFajr: "7:00", jZuhr: "1:00", jAsr: "3:30", maghrib: "5:02", jIsha: "6:30" },
            { date: [2026, 2, 7], day: "Sat", no: "", sehri: "", fajr: "6:04", sunrise: "7:44", zuhr: "12:21", asr: "3:08", isha: "6:30", jFajr: "7:00", jZuhr: "1:00", jAsr: "3:30", maghrib: "5:04", jIsha: "6:30" },
            { date: [2026, 2, 8], day: "Sun", no: "", sehri: "", fajr: "6:02", sunrise: "7:42", zuhr: "12:21", asr: "3:10", isha: "6:31", jFajr: "7:00", jZuhr: "1:00", jAsr: "3:30", maghrib: "5:06", jIsha: "6:30" },
            { date: [2026, 2, 9], day: "Mon", no: "", sehri: "", fajr: "6:01", sunrise: "7:40", zuhr: "12:21", asr: "3:12", isha: "6:32", jFajr: "7:00", jZuhr: "1:00", jAsr: "3:30", maghrib: "5:08", jIsha: "6:30" },
            { date: [2026, 2, 10], day: "Tue", no: "", sehri: "", fajr: "5:59", sunrise: "7:38", zuhr: "12:21", asr: "3:14", isha: "6:33", jFajr: "7:00", jZuhr: "1:00", jAsr: "3:30", maghrib: "5:10", jIsha: "6:30" },
            { date: [2026, 2, 11], day: "Wed", no: "", sehri: "", fajr: "5:57", sunrise: "7:36", zuhr: "12:21", asr: "3:16", isha: "6:34", jFajr: "6:45", jZuhr: "1:00", jAsr: "3:45", maghrib: "5:12", jIsha: "6:45" },
            { date: [2026, 2, 12], day: "Thu", no: "", sehri: "", fajr: "5:55", sunrise: "7:34", zuhr: "12:21", asr: "3:18", isha: "6:35", jFajr: "6:45", jZuhr: "1:00", jAsr: "3:45", maghrib: "5:14", jIsha: "6:45" },
            { date: [2026, 2, 13], day: "Fri", no: "", sehri: "", fajr: "5:54", sunrise: "7:32", zuhr: "12:21", asr: "3:20", isha: "6:35", jFajr: "6:45", jZuhr: "1:00", jAsr: "3:45", maghrib: "5:16", jIsha: "6:45" },
            { date: [2026, 2, 14], day: "Sat", no: "", sehri: "", fajr: "5:52", sunrise: "7:30", zuhr: "12:21", asr: "3:21", isha: "6:36", jFajr: "6:45", jZuhr: "1:00", jAsr: "3:45", maghrib: "5:18", jIsha: "6:45" },
            { date: [2026, 2, 15], day: "Sun", no: "", sehri: "", fajr: "5:50", sunrise: "7:28", zuhr: "12:21", asr: "3:23", isha: "6:37", jFajr: "6:45", jZuhr: "1:00", jAsr: "3:45", maghrib: "5:20", jIsha: "6:45" },
            { date: [2026, 2, 16], day: "Mon", no: "", sehri: "", fajr: "5:48", sunrise: "7:26", zuhr: "12:21", asr: "3:25", isha: "6:38", jFajr: "6:45", jZuhr: "1:00", jAsr: "3:45", maghrib: "5:22", jIsha: "6:45" },
            { date: [2026, 2, 17], day: "Tue", no: "", sehri: "", fajr: "5:46", sunrise: "7:24", zuhr: "12:21", asr: "3:27", isha: "6:39", jFajr: "6:45", jZuhr: "1:00", jAsr: "3:45", maghrib: "5:24", jIsha: "6:45" },
            // Ramadan 1447
            { date: [2026, 2, 18], day: "Wed", no: 1, sehri: "5:39", fajr: "5:44", sunrise: "7:22", zuhr: "12:21", asr: "3:29", isha: "6:40", jFajr: "5:59", jZuhr: "1:00", jAsr: "4:00", maghrib: "5:26", jIsha: "7:30" },
            { date: [2026, 2, 19], day: "Thu", no: 2, sehri: "5:37", fajr: "5:42", sunrise: "7:20", zuhr: "12:21", asr: "3:31", isha: "6:41", jFajr: "5:57", jZuhr: "1:00", jAsr: "4:00", maghrib: "5:28", jIsha: "7:30" },
            { date: [2026, 2, 20], day: "Fri", no: 3, sehri: "5:35", fajr: "5:40", sunrise: "7:17", zuhr: "12:21", asr: "3:32", isha: "6:43", jFajr: "5:55", jZuhr: "1:00", jAsr: "4:00", maghrib: "5:30", jIsha: "7:30" },
            { date: [2026, 2, 21], day: "Sat", no: 4, sehri: "5:33", fajr: "5:38", sunrise: "7:15", zuhr: "12:21", asr: "3:34", isha: "6:45", jFajr: "5:53", jZuhr: "1:00", jAsr: "4:00", maghrib: "5:32", jIsha: "7:30" },
            { date: [2026, 2, 22], day: "Sun", no: 5, sehri: "5:31", fajr: "5:36", sunrise: "7:13", zuhr: "12:20", asr: "3:36", isha: "6:47", jFajr: "5:51", jZuhr: "1:00", jAsr: "4:00", maghrib: "5:34", jIsha: "7:30" },
            { date: [2026, 2, 23], day: "Mon", no: 6, sehri: "5:29", fajr: "5:34", sunrise: "7:11", zuhr: "12:20", asr: "3:38", isha: "6:48", jFajr: "5:49", jZuhr: "1:00", jAsr: "4:00", maghrib: "5:36", jIsha: "7:30" },
            { date: [2026, 2, 24], day: "Tue", no: 7, sehri: "5:27", fajr: "5:32", sunrise: "7:09", zuhr: "12:20", asr: "3:39", isha: "6:50", jFajr: "5:47", jZuhr: "1:00", jAsr: "4:00", maghrib: "5:38", jIsha: "7:30" },
            { date: [2026, 2, 25], day: "Wed", no: 8, sehri: "5:25", fajr: "5:30", sunrise: "7:06", zuhr: "12:20", asr: "3:41", isha: "6:52", jFajr: "5:45", jZuhr: "1:00", jAsr: "4:00", maghrib: "5:40", jIsha: "7:30" },
            { date: [2026, 2, 26], day: "Thu", no: 9, sehri: "5:23", fajr: "5:28", sunrise: "7:04", zuhr: "12:20", asr: "3:43", isha: "6:54", jFajr: "5:43", jZuhr: "1:00", jAsr: "4:00", maghrib: "5:42", jIsha: "7:30" },
            { date: [2026, 2, 27], day: "Fri", no: 10, sehri: "5:20", fajr: "5:25", sunrise: "7:02", zuhr: "12:20", asr: "3:45", isha: "6:56", jFajr: "5:40", jZuhr: "1:00", jAsr: "4:00", maghrib: "5:44", jIsha: "7:30" },
            { date: [2026, 2, 28], day: "Sat", no: 11, sehri: "5:18", fajr: "5:23", sunrise: "7:00", zuhr: "12:20", asr: "3:46", isha: "6:58", jFajr: "5:38", jZuhr: "1:00", jAsr: "4:00", maghrib: "5:46", jIsha: "7:30" },
            { date: [2026, 3, 1], day: "Sun", no: 12, sehri: "5:14", fajr: "5:19", sunrise: "6:55", zuhr: "12:19", asr: "3:50", isha: "7:00", jFajr: "5:34", jZuhr: "1:00", jAsr: "4:30", maghrib: "5:47", jIsha: "8:00" },
            { date: [2026, 3, 2], day: "Mon", no: 13, sehri: "5:11", fajr: "5:16", sunrise: "6:53", zuhr: "12:19", asr: "3:52", isha: "7:02", jFajr: "5:31", jZuhr: "1:00", jAsr: "4:30", maghrib: "5:49", jIsha: "8:00" },
            { date: [2026, 3, 3], day: "Tue", no: 14, sehri: "5:09", fajr: "5:14", sunrise: "6:50", zuhr: "12:19", asr: "3:53", isha: "7:03", jFajr: "5:29", jZuhr: "1:00", jAsr: "4:30", maghrib: "5:52", jIsha: "8:00" },
            { date: [2026, 3, 4], day: "Wed", no: 15, sehri: "5:07", fajr: "5:12", sunrise: "6:48", zuhr: "12:19", asr: "3:55", isha: "7:05", jFajr: "5:27", jZuhr: "1:00", jAsr: "4:30", maghrib: "5:54", jIsha: "8:00" },
            { date: [2026, 3, 5], day: "Thu", no: 16, sehri: "5:04", fajr: "5:09", sunrise: "6:46", zuhr: "12:18", asr: "3:57", isha: "7:07", jFajr: "5:24", jZuhr: "1:00", jAsr: "4:30", maghrib: "5:56", jIsha: "8:00" },
            { date: [2026, 3, 6], day: "Fri", no: 17, sehri: "5:02", fajr: "5:07", sunrise: "6:43", zuhr: "12:18", asr: "3:58", isha: "7:09", jFajr: "5:22", jZuhr: "1:00", jAsr: "4:30", maghrib: "5:58", jIsha: "8:00" },
            { date: [2026, 3, 7], day: "Sat", no: 18, sehri: "4:59", fajr: "5:04", sunrise: "6:41", zuhr: "12:18", asr: "4:00", isha: "7:11", jFajr: "5:19", jZuhr: "1:00", jAsr: "4:30", maghrib: "6:00", jIsha: "8:00" },
            { date: [2026, 3, 8], day: "Sun", no: 19, sehri: "4:57", fajr: "5:02", sunrise: "6:38", zuhr: "12:18", asr: "4:01", isha: "7:13", jFajr: "5:17", jZuhr: "1:00", jAsr: "4:30", maghrib: "6:02", jIsha: "8:00" },
            { date: [2026, 3, 9], day: "Mon", no: 20, sehri: "4:53", fajr: "4:59", sunrise: "6:36", zuhr: "12:17", asr: "4:03", isha: "7:15", jFajr: "5:13", jZuhr: "1:00", jAsr: "4:30", maghrib: "6:04", jIsha: "8:00" },
            { date: [2026, 3, 10], day: "Tue", no: 21, sehri: "4:52", fajr: "4:57", sunrise: "6:34", zuhr: "12:17", asr: "4:05", isha: "7:17", jFajr: "5:12", jZuhr: "1:00", jAsr: "4:30", maghrib: "6:06", jIsha: "8:00" },
            { date: [2026, 3, 11], day: "Wed", no: 22, sehri: "4:50", fajr: "4:55", sunrise: "6:31", zuhr: "12:17", asr: "4:06", isha: "7:19", jFajr: "5:10", jZuhr: "1:00", jAsr: "4:45", maghrib: "6:08", jIsha: "8:30" },
            { date: [2026, 3, 12], day: "Thu", no: 23, sehri: "4:47", fajr: "4:52", sunrise: "6:29", zuhr: "12:17", asr: "4:08", isha: "7:21", jFajr: "5:07", jZuhr: "1:00", jAsr: "4:45", maghrib: "6:10", jIsha: "8:30" },
            { date: [2026, 3, 13], day: "Fri", no: 24, sehri: "4:44", fajr: "4:49", sunrise: "6:26", zuhr: "12:16", asr: "4:09", isha: "7:24", jFajr: "5:04", jZuhr: "1:00", jAsr: "4:45", maghrib: "6:12", jIsha: "8:30" },
            { date: [2026, 3, 14], day: "Sat", no: 25, sehri: "4:42", fajr: "4:47", sunrise: "6:24", zuhr: "12:16", asr: "4:11", isha: "7:25", jFajr: "5:02", jZuhr: "1:00", jAsr: "4:45", maghrib: "6:14", jIsha: "8:30" },
            { date: [2026, 3, 15], day: "Sun", no: 26, sehri: "4:39", fajr: "4:44", sunrise: "6:22", zuhr: "12:16", asr: "4:12", isha: "7:27", jFajr: "4:59", jZuhr: "1:00", jAsr: "4:45", maghrib: "6:16", jIsha: "8:30" },
            { date: [2026, 3, 16], day: "Mon", no: 27, sehri: "4:37", fajr: "4:42", sunrise: "6:19", zuhr: "12:16", asr: "4:14", isha: "7:28", jFajr: "4:57", jZuhr: "1:00", jAsr: "4:45", maghrib: "6:18", jIsha: "8:30" },
            { date: [2026, 3, 17], day: "Tue", no: 28, sehri: "4:34", fajr: "4:39", sunrise: "6:17", zuhr: "12:15", asr: "4:16", isha: "7:30", jFajr: "4:54", jZuhr: "1:00", jAsr: "4:45", maghrib: "6:20", jIsha: "8:30" },
            { date: [2026, 3, 18], day: "Wed", no: 29, sehri: "4:31", fajr: "4:36", sunrise: "6:14", zuhr: "12:15", asr: "4:18", isha: "7:32", jFajr: "4:51", jZuhr: "1:00", jAsr: "4:45", maghrib: "6:22", jIsha: "8:30" },
            { date: [2026, 3, 19], day: "Thu", no: 30, sehri: "4:29", fajr: "4:34", sunrise: "6:12", zuhr: "12:15", asr: "4:20", isha: "7:34", jFajr: "4:49", jZuhr: "1:00", jAsr: "4:45", maghrib: "6:24", jIsha: "8:30" },
            { date: [2026, 3, 20], day: "Fri", no: "", sehri: "4:26", fajr: "4:31", sunrise: "6:09", zuhr: "12:15", asr: "4:21", isha: "7:36", jFajr: "4:46", jZuhr: "1:00", jAsr: "4:45", maghrib: "6:26", jIsha: "8:30" }
        ];

        // Ramadan start and end dates
        const ramadanStart = new Date(2026, 1, 18); // Feb 18, 2026
        const ramadanEnd = new Date(2026, 2, 20);   // Mar 20, 2026

        // Render table
        function renderTable() {
            const tbody = document.getElementById('tableBody');
            const today = getEffectiveToday();

            tbody.innerHTML = timetableData.map((row, index) => {
                const rowDate = new Date(row.date[0], row.date[1] - 1, row.date[2]);
                const isToday = rowDate.getTime() === today.getTime();
                const isFriday = row.day === "Fri";
                
                const isLastTen = row.no >= 21;
                const isOddNight = row.no >= 21 && row.no % 2 === 1;

                let rowClasses = [];
                if (isToday) rowClasses.push('today');
                else if (isFriday) rowClasses.push('friday');
                if (isOddNight) rowClasses.push('odd-night');
                else if (isLastTen) rowClasses.push('last-ten');

                const todayBadge = isToday ? '<span class="today-badge">TODAY</span>' : '';
                const lastTenBadge = isOddNight ? '<span class="last-ten-badge">ODD</span>' : '';
                const displayDate = row.date[2];

                return `
                    <tr class="${rowClasses.join(' ')}" data-date="${row.date.join('-')}">
                        <td class="date-col">${displayDate}${todayBadge}</td>
                        <td class="day-col">${row.day}</td>
                        <td class="no-col">${row.no}${lastTenBadge}</td>
                        <td class="sehri-col">${row.sehri}</td>
                        <td>${row.fajr}</td>
                        <td>${row.sunrise}</td>
                        <td>${row.zuhr}</td>
                        <td>${row.asr}</td>
                        <td>${row.isha}</td>
                        <td>${row.jFajr}</td>
                        <td>${row.jZuhr}</td>
                        <td>${row.jAsr}</td>
                        <td class="iftari-col">${row.maghrib}</td>
                        <td>${row.jIsha}</td>
                    </tr>
                `;
            }).join('');

            // Scroll to today's row
            const todayRow = document.querySelector('.today');
            if (todayRow) {
                setTimeout(() => {
                    todayRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            }
        }

        // Get today's timetable entry
        function getTodayData() {
            if (demoMode && demoDateIndex >= 0) return timetableData[demoDateIndex];
            if (demoMode && demoDateIndex < 0) return null;
            const today = new Date();
            return timetableData.find(row => {
                const rowDate = new Date(row.date[0], row.date[1] - 1, row.date[2]);
                return rowDate.toDateString() === today.toDateString();
            });
        }

        // Parse time string to today's Date object
        function parseTime(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            const date = new Date();
            date.setHours(hours, minutes, 0, 0);
            return date;
        }

        // Update countdown
        function updateCountdown() {
            const now = getEffectiveNow();
            const todayData = getTodayData();
            const countdownSection = document.getElementById('countdownSection');
            const daysContainer = document.getElementById('daysContainer');

            // Check if we're before Ramadan
            const today = getEffectiveToday();

            if (today < ramadanStart) {
                // Show countdown to Ramadan
                countdownSection.classList.add('pre-ramadan');
                daysContainer.style.display = 'block';

                const diff = ramadanStart - now;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                document.getElementById('countdownLabel').textContent = '游깿 Countdown to Ramadan 1447';
                document.getElementById('days').textContent = days.toString().padStart(2, '0');
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
                document.getElementById('nextPrayer').innerHTML = `Ramadan begins <span class="next-prayer-time">Wed 18th February</span>`;
                return;
            }

            // Check if we're after Ramadan
            if (today > ramadanEnd) {
                countdownSection.classList.remove('pre-ramadan');
                daysContainer.style.display = 'none';
                document.getElementById('countdownLabel').textContent = 'Ramadan 1447 has ended';
                document.getElementById('hours').textContent = '--';
                document.getElementById('minutes').textContent = '--';
                document.getElementById('seconds').textContent = '--';
                document.getElementById('nextPrayer').innerHTML = `<span class="next-prayer-time">Eid Mubarak! 游깿</span>`;
                return;
            }

            // During Ramadan (or demo mode)
            countdownSection.classList.remove('pre-ramadan');
            daysContainer.style.display = 'none';

            if (!todayData) {
                document.getElementById('countdownLabel').textContent = 'Ramadan timetable for Feb 18 - Mar 20, 2026';
                document.getElementById('hours').textContent = '--';
                document.getElementById('minutes').textContent = '--';
                document.getElementById('seconds').textContent = '--';
                document.getElementById('nextPrayer').textContent = '';
                return;
            }

            // Helper: parse time string to Date, with optional PM flag
            function toDate(timeStr, isPM) {
                const [h, m] = timeStr.split(':').map(Number);
                const d = new Date(now);
                d.setHours(isPM && h < 12 ? h + 12 : h, m, 0, 0);
                return d;
            }

            // Build prayer sequence in chronological order
            const events = [
                { label: '游꽇勇 Sehri ends', time: toDate(todayData.sehri, false), display: todayData.sehri },
                { label: '游뎳 Fajr Jamaah', time: toDate(todayData.jFajr, false), display: todayData.jFajr },
                { label: '驕勇 Zuhr begins', time: toDate(todayData.zuhr, false), display: todayData.zuhr },
                { label: '游뎳 Zuhr Jamaah', time: toDate(todayData.jZuhr, true), display: todayData.jZuhr },
                { label: '驕勇 Asr begins', time: toDate(todayData.asr, true), display: todayData.asr },
                { label: '游뎳 Asr Jamaah', time: toDate(todayData.jAsr, true), display: todayData.jAsr },
                { label: '游깬 Iftar', time: toDate(todayData.maghrib, true), display: todayData.maghrib },
                { label: '驕勇 Isha begins', time: toDate(todayData.isha, true), display: todayData.isha },
                { label: '游뎳 Isha Jamaah', time: toDate(todayData.jIsha, true), display: todayData.jIsha },
            ];

            // Find next upcoming event
            const nextEvent = events.find(e => now < e.time);

            if (nextEvent) {
                const diff = nextEvent.time - now;
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                document.getElementById('countdownLabel').textContent = nextEvent.label;
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
                document.getElementById('nextPrayer').innerHTML = `${nextEvent.label.replace(/^\S+\s/, '')} at <span class="next-prayer-time">${nextEvent.display}</span>`;
                return;
            }

            // After Isha Jamaah - countdown to tomorrow's Sehri
            const tomorrowIndex = timetableData.indexOf(todayData) + 1;
            if (tomorrowIndex < timetableData.length) {
                const tmrw = timetableData[tomorrowIndex];
                const [sH, sM] = tmrw.sehri.split(':').map(Number);
                const sehriTmrw = new Date(now);
                sehriTmrw.setDate(sehriTmrw.getDate() + 1);
                sehriTmrw.setHours(sH, sM, 0, 0);

                const diff = sehriTmrw - now;
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                document.getElementById('countdownLabel').textContent = '游꽇勇 Sehri ends tomorrow';
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
                document.getElementById('nextPrayer').innerHTML = `Sehri ends at <span class="next-prayer-time">${tmrw.sehri}</span>`;
                return;
            }

            // Last day after Isha - Ramadan ending
            document.getElementById('countdownLabel').textContent = '九 Eid Mubarak!';
            document.getElementById('hours').textContent = '00';
            document.getElementById('minutes').textContent = '00';
            document.getElementById('seconds').textContent = '00';
            document.getElementById('nextPrayer').innerHTML = `<span class="next-prayer-time">Ramadan 1447 complete</span>`;
        }

        // Notifications
        let notificationsEnabled = localStorage.getItem('notifications') === 'true';
        let lastNotification = '';

        function toggleNotifications() {
            if (!('Notification' in window)) {
                alert('Your browser does not support notifications.');
                return;
            }
            if (notificationsEnabled) {
                notificationsEnabled = false;
                localStorage.setItem('notifications', 'false');
                updateNotifyButton();
                return;
            }
            Notification.requestPermission().then(perm => {
                if (perm === 'granted') {
                    notificationsEnabled = true;
                    localStorage.setItem('notifications', 'true');
                    new Notification('Reminders enabled', { body: 'You will be notified 15 minutes before Sehri ends and Iftar.' });
                }
                updateNotifyButton();
            });
        }

        function updateNotifyButton() {
            const btn = document.getElementById('notifyBtn');
            if (notificationsEnabled) {
                btn.classList.add('active');
                btn.title = 'Disable Sehri/Iftar reminders';
            } else {
                btn.classList.remove('active');
                btn.title = 'Enable Sehri/Iftar reminders';
            }
        }

        function checkNotifications() {
            if (!notificationsEnabled) return;
            const todayData = getTodayData();
            if (!todayData) return;

            const now = new Date();
            const currentMins = now.getHours() * 60 + now.getMinutes();

            const [sehriH, sehriM] = todayData.sehri.split(':').map(Number);
            const sehriMins = sehriH * 60 + sehriM;

            const [iftarH, iftarM] = todayData.maghrib.split(':').map(Number);
            const iftarHour24 = iftarH < 12 ? iftarH + 12 : iftarH;
            const iftarMins = iftarHour24 * 60 + iftarM;

            const key = now.toDateString();

            if (currentMins === sehriMins - 15 && lastNotification !== key + '-sehri') {
                lastNotification = key + '-sehri';
                new Notification('Sehri ending soon!', { body: `Sehri ends at ${todayData.sehri} - 15 minutes remaining.` });
            }
            if (currentMins === iftarMins - 15 && lastNotification !== key + '-iftar') {
                lastNotification = key + '-iftar';
                new Notification('Iftar in 15 minutes!', { body: `Iftar at ${todayData.maghrib} - almost time to break your fast.` });
            }
        }

        // WhatsApp share
        function shareWhatsApp() {
            const text = encodeURIComponent('Ramadan 1447 Prayer Timetable - Shahjalal Islamic Society, Bradford\nhttps://waqt.uk/shahjalal/');
            window.open('https://wa.me/?text=' + text, '_blank');
        }

        // Dark mode toggle
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const btn = document.querySelector('.dark-mode-toggle');
            btn.textContent = document.body.classList.contains('dark-mode') ? '驕勇' : '游깿';
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // Demo mode
        let demoMode = false;
        let demoDateIndex = -1;
        let demoMinutes = 720; // minutes since midnight (default noon)

        function getEffectiveNow() {
            if (!demoMode) return new Date();
            let d;
            if (demoDateIndex === -2) {
                d = new Date(2026, 1, 10); // Before Ramadan
            } else if (demoDateIndex === -3) {
                d = new Date(2026, 2, 25); // After Ramadan
            } else if (demoDateIndex >= 0) {
                const row = timetableData[demoDateIndex];
                d = new Date(row.date[0], row.date[1] - 1, row.date[2]);
            } else {
                return new Date();
            }
            d.setHours(Math.floor(demoMinutes / 60), demoMinutes % 60, 30, 0);
            return d;
        }

        function getEffectiveToday() {
            const d = new Date(getEffectiveNow());
            d.setHours(0, 0, 0, 0);
            return d;
        }

        function toggleDemoPanel() {
            const panel = document.getElementById('demoPanel');
            const btn = document.getElementById('demoToggle');
            panel.classList.toggle('open');
            if (panel.classList.contains('open') && !demoMode) {
                activateDemo();
            }
        }

        function activateDemo() {
            demoMode = true;
            document.getElementById('demoToggle').classList.add('active');
            document.getElementById('demoToggle').innerHTML = 'DEMO<span class="demo-badge">ON</span>';
            renderTable();
            updateCountdown();
        }

        function populateDemoDateSelect() {
            const sel = document.getElementById('demoDate');
            const opts = ['<option value="-2">Before Ramadan (Feb 10)</option>'];
            timetableData.forEach((row, i) => {
                const label = `${row.day} ${row.date[2]}/${row.date[1]} - Day ${row.no || 'Eid'}`;
                opts.push(`<option value="${i}">${label}</option>`);
            });
            opts.push('<option value="-3">After Ramadan (Mar 25)</option>');
            sel.innerHTML = opts.join('');
        }

        function onDemoDateChange() {
            demoDateIndex = parseInt(document.getElementById('demoDate').value);
            if (!demoMode) activateDemo();
            renderTable();
            updateCountdown();
            if (currentView === 'today') renderTodayView();
        }

        function onDemoTimeChange() {
            demoMinutes = parseInt(document.getElementById('demoTime').value);
            const h = Math.floor(demoMinutes / 60);
            const m = demoMinutes % 60;
            document.getElementById('demoTimeDisplay').textContent =
                h.toString().padStart(2, '0') + ':' + m.toString().padStart(2, '0');
            if (!demoMode) activateDemo();
            updateCountdown();
            if (currentView === 'today') renderTodayView();
        }

        function resetDemo() {
            demoMode = false;
            demoDateIndex = -1;
            demoMinutes = 720;
            document.getElementById('demoToggle').classList.remove('active');
            document.getElementById('demoToggle').textContent = 'DEMO';
            document.getElementById('demoPanel').classList.remove('open');
            document.getElementById('demoDate').value = '-2';
            document.getElementById('demoTime').value = 720;
            document.getElementById('demoTimeDisplay').textContent = '12:00';
            renderTable();
            updateCountdown();
            if (currentView === 'today') renderTodayView();
        }

        // Today View
        let currentView = localStorage.getItem('viewMode') || 'today';

        function renderTodayView() {
            const todayData = getTodayData();
            const todayView = document.getElementById('todayView');

            if (!todayData) {
                document.getElementById('todayCards').innerHTML = '<div style="text-align:center;padding:30px;opacity:0.6;">No timetable data for today</div>';
                document.getElementById('todayDateBar').textContent = '';
                document.getElementById('todayTomorrow').style.display = 'none';
                return;
            }

            const now = getEffectiveNow();
            const rowDate = new Date(todayData.date[0], todayData.date[1] - 1, todayData.date[2]);
            const dayNames = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
            const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];

            const isRamadan = todayData.sehri && todayData.sehri !== "";
            document.getElementById('todayDateBar').textContent = isRamadan
                ? `Day ${todayData.no || 'Eid'} of Ramadan  \u2022  ${dayNames[rowDate.getDay()]} ${rowDate.getDate()} ${monthNames[rowDate.getMonth()]} ${rowDate.getFullYear()}`
                : `${dayNames[rowDate.getDay()]} ${rowDate.getDate()} ${monthNames[rowDate.getMonth()]} ${rowDate.getFullYear()}`;

            function toDate24(timeStr, isPM) {
                const [h, m] = timeStr.split(':').map(Number);
                const d = new Date(now);
                d.setHours(isPM && h < 12 ? h + 12 : h, m, 0, 0);
                return d;
            }

            const isFriday = todayData.day === 'Fri';

            function addMinutes(timeStr, mins) {
                const [h, m] = timeStr.split(':').map(Number);
                const totalMins = h * 60 + m + mins;
                return `${Math.floor(totalMins / 60)}:${(totalMins % 60).toString().padStart(2, '0')}`;
            }

            const prayers = isRamadan ? [
                { name: 'Sehri', mainTime: todayData.sehri, isPM: false, details: [
                    { label: 'Fajr Start', value: todayData.fajr },
                    { label: 'Fajr Jamaah', value: todayData.jFajr }
                ], eventTime: toDate24(todayData.sehri, false) },
                { name: 'Sunrise', mainTime: todayData.sunrise, isPM: false, details: [], eventTime: toDate24(todayData.sunrise, false) },
                { name: isFriday ? 'Jumu\'ah' : 'Zuhr', mainTime: todayData.zuhr, isPM: false, details: [
                    { label: 'Jamaah', value: todayData.jZuhr }
                ], eventTime: toDate24(todayData.zuhr, false) },
                { name: 'Asr', mainTime: todayData.asr, isPM: true, details: [
                    { label: 'Jamaah', value: todayData.jAsr }
                ], eventTime: toDate24(todayData.asr, true) },
                { name: 'Iftar / Maghrib', mainTime: todayData.maghrib, isPM: true, details: [], eventTime: toDate24(todayData.maghrib, true) },
                { name: 'Isha', mainTime: todayData.isha, isPM: true, details: [
                    { label: 'Jamaah', value: todayData.jIsha }
                ], eventTime: toDate24(todayData.isha, true) }
            ] : [
                { name: 'Fajr', mainTime: todayData.fajr, isPM: false, details: [
                    { label: 'Jamaah', value: todayData.jFajr }
                ], eventTime: toDate24(todayData.fajr, false) },
                { name: 'Sunrise', mainTime: todayData.sunrise, isPM: false, details: [
                    { label: 'Ishraq', value: addMinutes(todayData.sunrise, 20) }
                ], eventTime: toDate24(todayData.sunrise, false) },
                { name: isFriday ? 'Jumu\'ah' : 'Zuhr', mainTime: todayData.zuhr, isPM: false, details: [
                    { label: 'Jamaah', value: todayData.jZuhr }
                ], eventTime: toDate24(todayData.zuhr, false) },
                { name: 'Asr', mainTime: todayData.asr, isPM: true, details: [
                    { label: 'Jamaah', value: todayData.jAsr }
                ], eventTime: toDate24(todayData.asr, true) },
                { name: 'Maghrib', mainTime: todayData.maghrib, isPM: true, details: [], eventTime: toDate24(todayData.maghrib, true) },
                { name: 'Isha', mainTime: todayData.isha, isPM: true, details: [
                    { label: 'Jamaah', value: todayData.jIsha }
                ], eventTime: toDate24(todayData.isha, true) }
            ];

            // Find next prayer
            let nextIndex = -1;
            for (let i = 0; i < prayers.length; i++) {
                if (now < prayers[i].eventTime) { nextIndex = i; break; }
            }

            document.getElementById('todayCards').innerHTML = prayers.map((p, i) => {
                const isPassed = nextIndex === -1 || i < nextIndex;
                const isNext = i === nextIndex;

                let cls = 'prayer-card';
                if (isPassed && nextIndex !== -1) cls += ' passed';
                if (isNext) cls += ' active-prayer';

                const badge = isNext ? '<span class="next-badge">NEXT</span>' : '';
                const details = p.details.length
                    ? `<div class="prayer-card-details">${p.details.map(d => `<div class="prayer-card-detail">${d.label} <strong>${d.value}</strong></div>`).join('')}</div>`
                    : '';

                return `<div class="${cls}"><div class="prayer-card-header"><div class="prayer-card-name">${p.name}${badge}</div><div class="prayer-card-time">${p.mainTime}</div></div>${details}</div>`;
            }).join('');

            // Tomorrow preview
            const tomorrowIndex = timetableData.indexOf(todayData) + 1;
            const tmrwEl = document.getElementById('todayTomorrow');
            if (tomorrowIndex < timetableData.length) {
                const tmrw = timetableData[tomorrowIndex];
                const tmrwIsRamadan = tmrw.sehri && tmrw.sehri !== "";
                if (tmrwIsRamadan) {
                    let html = `Tomorrow: Sehri ends <strong>${tmrw.sehri}</strong> &nbsp;\u2022&nbsp; Iftar <strong>${tmrw.maghrib}</strong>`;
                    const ramChanges = [];
                    if (todayData.jFajr !== tmrw.jFajr) ramChanges.push(`Fajr <strong>${tmrw.jFajr}</strong>`);
                    if (todayData.jZuhr !== tmrw.jZuhr) ramChanges.push(`Zuhr <strong>${tmrw.jZuhr}</strong>`);
                    if (todayData.jAsr !== tmrw.jAsr) ramChanges.push(`Asr <strong>${tmrw.jAsr}</strong>`);
                    if (todayData.jIsha !== tmrw.jIsha) ramChanges.push(`Isha <strong>${tmrw.jIsha}</strong>`);
                    if (ramChanges.length) {
                        html += `<br>Jamaah changes: ${ramChanges.join(' &nbsp;\u2022&nbsp; ')}`;
                    }
                    tmrwEl.innerHTML = html;
                    tmrwEl.style.display = '';
                } else {
                    const changes = [];
                    if (todayData.jFajr !== tmrw.jFajr) changes.push(`Fajr <strong>${tmrw.jFajr}</strong>`);
                    if (todayData.jZuhr !== tmrw.jZuhr) changes.push(`Zuhr <strong>${tmrw.jZuhr}</strong>`);
                    if (todayData.jAsr !== tmrw.jAsr) changes.push(`Asr <strong>${tmrw.jAsr}</strong>`);
                    if (todayData.jIsha !== tmrw.jIsha) changes.push(`Isha <strong>${tmrw.jIsha}</strong>`);
                    if (changes.length) {
                        tmrwEl.innerHTML = `Jamaah changes tomorrow: ${changes.join(' &nbsp;\u2022&nbsp; ')}`;
                        tmrwEl.style.display = '';
                    } else {
                        tmrwEl.style.display = 'none';
                    }
                }
            } else {
                tmrwEl.style.display = 'none';
            }
        }

        function setView(view) {
            currentView = view;
            localStorage.setItem('viewMode', view);

            const todayView = document.getElementById('todayView');
            const tableContainer = document.getElementById('tableContainer');

            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
            });

            if (view === 'today') {
                todayView.style.display = '';
                tableContainer.style.display = 'none';
                renderTodayView();
            } else {
                todayView.style.display = 'none';
                tableContainer.style.display = '';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Check saved dark mode preference
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                document.querySelector('.dark-mode-toggle').textContent = '驕勇';
            }

            populateDemoDateSelect();
            renderTable();
            updateCountdown();
            setInterval(updateCountdown, 1000);
            setInterval(checkNotifications, 30000);
            updateNotifyButton();

            // View toggle
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', () => setView(btn.dataset.view));
            });
            const todayData = getTodayData();
            if (!localStorage.getItem('viewMode')) {
                currentView = 'today';
            }
            setView(currentView);
            setInterval(() => { if (currentView === 'today') renderTodayView(); }, 60000);

            // Register service worker for offline support
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js');
            }
        });

    </script>
    <script src="../nav.js"></script>

    <!-- Granim.js - async loaded, never blocks page -->
    <script>
    (function() {
        var canvas = document.getElementById('shaderCanvas');
        if (!canvas) return;
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || window.innerWidth < 600) {
            canvas.style.display = 'none';
            var headerEl = document.querySelector('.header');
            if (headerEl) headerEl.classList.remove('shimmer');
            return;
        }
        var s = document.createElement('script');
        s.src = 'https://cdn.jsdelivr.net/npm/granim@2.0.0/dist/granim.min.js';
        s.async = true;
        s.onload = function() {
            if (typeof Granim === 'undefined') { canvas.style.display = 'none'; return; }
            // Remove shimmer now that Granim is loaded
            var headerEl = document.querySelector('.header');
            if (headerEl) headerEl.classList.remove('shimmer');
            var isDark = document.body.classList.contains('dark-mode');
            var granimInstance = new Granim({
                element: '#shaderCanvas',
                direction: 'diagonal',
                isPausedWhenNotInView: true,
                stateTransitionSpeed: 500,
                states: {
                    "default-state": {
                        gradients: isDark
                            ? [['#001a15', '#002620'], ['#003d33', '#001a2e'], ['#002620', '#003d33']]
                            : [['#004d40', '#00796b'], ['#00695c', '#00bcd4'], ['#005b4f', '#26a69a']],
                        transitionSpeed: 4000,
                    }
                }
            });
            // Update Granim on dark mode toggle
            var origToggle = window.toggleDarkMode;
            window.toggleDarkMode = function() {
                origToggle();
                var nowDark = document.body.classList.contains('dark-mode');
                granimInstance.changeState('default-state');
                granimInstance.states['default-state'].gradients = nowDark
                    ? [['#001a15', '#002620'], ['#003d33', '#001a2e'], ['#002620', '#003d33']]
                    : [['#004d40', '#00796b'], ['#00695c', '#00bcd4'], ['#005b4f', '#26a69a']];
            };
        };
        s.onerror = function() {
            canvas.style.display = 'none';
            var headerEl = document.querySelector('.header');
            if (headerEl) headerEl.classList.remove('shimmer');
        };
        document.body.appendChild(s);
    })();
    </script>

    <!-- Floating star field in countdown section -->
    <script>
    (function() {
        var canvas = document.getElementById('starCanvas');
        if (!canvas) return;
        if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) { canvas.style.display = 'none'; return; }
        var ctx = canvas.getContext('2d');
        if (!ctx) { canvas.style.display = 'none'; return; }

        var stars = [];
        var w, h;

        function resize() {
            var rect = canvas.parentElement.getBoundingClientRect();
            w = canvas.width = rect.width;
            h = canvas.height = rect.height;
            // Regenerate stars on resize
            stars = [];
            var count = Math.floor(w * h / 1200);
            count = Math.min(count, 80);
            for (var i = 0; i < count; i++) {
                stars.push({
                    x: Math.random() * w,
                    y: Math.random() * h,
                    r: Math.random() * 1.2 + 0.3,
                    speed: Math.random() * 0.0008 + 0.0004,
                    phase: Math.random() * Math.PI * 2
                });
            }
        }
        resize();
        window.addEventListener('resize', resize);

        function draw(t) {
            ctx.clearRect(0, 0, w, h);
            for (var i = 0; i < stars.length; i++) {
                var s = stars[i];
                var alpha = 0.3 + 0.7 * ((Math.sin(t * s.speed + s.phase) + 1) / 2);
                ctx.beginPath();
                ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 255, 255, ' + alpha + ')';
                ctx.fill();
            }
            requestAnimationFrame(draw);
        }
        requestAnimationFrame(draw);
    })();
    </script>

    <!-- Countdown tick animation -->
    <script>
        (function() {
            const ids = ['hours', 'minutes', 'seconds', 'days'];
            const prev = {};
            ids.forEach(id => prev[id] = '');

            setInterval(() => {
                ids.forEach(id => {
                    const el = document.getElementById(id);
                    if (!el) return;
                    const val = el.textContent;
                    if (val !== prev[id] && prev[id] !== '') {
                        el.classList.add('tick');
                        setTimeout(() => el.classList.remove('tick'), 200);
                    }
                    prev[id] = val;
                });
            }, 250);
        })();
    </script>

    <!-- View transition animation -->
    <script>
        (function() {
            const origSetView = window.setView;
            if (!origSetView) return;
            window.setView = function(view) {
                const todayView = document.getElementById('todayView');
                const tableContainer = document.getElementById('tableContainer');
                const target = view === 'today' ? todayView : tableContainer;

                target.classList.add('view-fade-enter');
                origSetView(view);
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        target.classList.remove('view-fade-enter');
                    });
                });
            };
        })();
    </script>

    <!-- Feature 1: Countdown Flip Animation -->
    <script>
    (function() {
        const ids = ['hours', 'minutes', 'seconds', 'days'];
        const prevDigits = {};
        ids.forEach(id => prevDigits[id] = '');

        // Wrap each character in the countdown values with flip-digit spans
        function wrapDigits(el) {
            const text = el.textContent;
            el.innerHTML = text.split('').map((ch, i) =>
                '<span class="flip-digit" data-idx="' + i + '">' + ch + '</span>'
            ).join('');
        }

        setInterval(() => {
            ids.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                // Get raw text (strip any existing spans)
                const rawText = el.textContent;
                if (rawText === prevDigits[id]) return;

                const oldVal = prevDigits[id];
                prevDigits[id] = rawText;

                // Wrap digits
                wrapDigits(el);

                // Flip only changed digits
                if (oldVal && oldVal.length === rawText.length) {
                    const spans = el.querySelectorAll('.flip-digit');
                    for (let i = 0; i < rawText.length; i++) {
                        if (oldVal[i] !== rawText[i] && spans[i]) {
                            spans[i].classList.add('flipping');
                            (function(span) {
                                setTimeout(() => span.classList.remove('flipping'), 350);
                            })(spans[i]);
                        }
                    }
                }
            });
        }, 300);
    })();
    </script>

    <!-- Feature 3: Eid Confetti Burst -->
    <script>
    (function() {
        let confettiFired = false;

        function checkEidConfetti() {
            if (confettiFired) return;
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

            const label = document.getElementById('countdownLabel');
            const nextPrayer = document.getElementById('nextPrayer');
            if (!label || !nextPrayer) return;

            const labelText = label.textContent || '';
            const nextText = nextPrayer.textContent || '';

            if (labelText.includes('Eid Mubarak') || nextText.includes('Eid Mubarak')) {
                confettiFired = true;
                launchConfetti();
            }
        }

        function launchConfetti() {
            const canvas = document.createElement('canvas');
            canvas.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;';
            document.body.appendChild(canvas);
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const colors = ['#ffd54f', '#00796b', '#ffffff', '#4caf50', '#ff9800', '#e91e63'];
            const particles = [];

            for (let i = 0; i < 150; i++) {
                particles.push({
                    x: canvas.width / 2 + (Math.random() - 0.5) * 200,
                    y: -10,
                    vx: (Math.random() - 0.5) * 12,
                    vy: Math.random() * -15 - 5,
                    w: Math.random() * 8 + 3,
                    h: Math.random() * 6 + 2,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    rotation: Math.random() * 360,
                    rotSpeed: (Math.random() - 0.5) * 10,
                    gravity: 0.3 + Math.random() * 0.2,
                    wind: (Math.random() - 0.5) * 0.5,
                    isCircle: Math.random() > 0.5,
                    opacity: 1
                });
            }

            const startTime = Date.now();
            const duration = 5000;

            function animate() {
                const elapsed = Date.now() - startTime;
                if (elapsed > duration) {
                    canvas.remove();
                    return;
                }

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                const fadeStart = duration * 0.7;
                const globalAlpha = elapsed > fadeStart ? 1 - (elapsed - fadeStart) / (duration - fadeStart) : 1;

                particles.forEach(p => {
                    p.vy += p.gravity;
                    p.vx += p.wind;
                    p.x += p.vx;
                    p.y += p.vy;
                    p.rotation += p.rotSpeed;
                    p.vx *= 0.99;

                    ctx.save();
                    ctx.translate(p.x, p.y);
                    ctx.rotate(p.rotation * Math.PI / 180);
                    ctx.globalAlpha = globalAlpha * p.opacity;
                    ctx.fillStyle = p.color;

                    if (p.isCircle) {
                        ctx.beginPath();
                        ctx.arc(0, 0, p.w / 2, 0, Math.PI * 2);
                        ctx.fill();
                    } else {
                        ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
                    }
                    ctx.restore();
                });

                requestAnimationFrame(animate);
            }
            animate();
        }

        // Check periodically for Eid state
        setInterval(checkEidConfetti, 2000);
        // Also check on page load (after a short delay for countdown to render)
        setTimeout(checkEidConfetti, 1500);
    })();
    </script>

    <!-- Feature 4: Ramadan Progress Bar -->
    <script>
    (function() {
        function updateRamadanProgress() {
            const bar = document.getElementById('ramadanProgress');
            const fill = document.getElementById('progressFill');
            const text = document.getElementById('progressText');
            if (!bar || !fill || !text) return;

            const today = getEffectiveToday();
            const todayData = getTodayData();

            // Only show during Ramadan
            if (today < ramadanStart || today > ramadanEnd || !todayData) {
                bar.classList.remove('visible');
                return;
            }

            const dayNum = todayData.no;
            if (!dayNum || dayNum === '') {
                // Eid day (day 31 row) - show complete
                bar.classList.add('visible');
                fill.style.width = '100%';
                text.textContent = 'Eid Mubarak!';
                return;
            }

            const totalDays = 30;
            const pct = Math.min((dayNum / totalDays) * 100, 100);

            bar.classList.add('visible');
            fill.style.width = pct + '%';
            text.textContent = 'Day ' + dayNum + ' of ' + totalDays;
        }

        // Update on load and every 60s
        document.addEventListener('DOMContentLoaded', () => {
            updateRamadanProgress();
            setInterval(updateRamadanProgress, 60000);
        });

        // Also update when demo changes (hook into existing functions)
        const origOnDemoDateChange = window.onDemoDateChange;
        window.onDemoDateChange = function() {
            origOnDemoDateChange();
            updateRamadanProgress();
        };
        const origOnDemoTimeChange = window.onDemoTimeChange;
        window.onDemoTimeChange = function() {
            origOnDemoTimeChange();
            updateRamadanProgress();
        };
        const origResetDemo = window.resetDemo;
        window.resetDemo = function() {
            origResetDemo();
            updateRamadanProgress();
        };
    })();
    </script>

    <!-- Feature 5: Auto Dark Mode at Maghrib -->
    <script>
    (function() {
        const AUTO_DARK_KEY = 'shahjalal-autoDark';

        function isAutoDarkEnabled() {
            const val = localStorage.getItem(AUTO_DARK_KEY);
            return val === null || val === 'true'; // default true
        }

        function checkAutoDark() {
            if (!isAutoDarkEnabled()) return;
            if (demoMode) return; // Don't auto-toggle in demo

            const todayData = getTodayData();
            if (!todayData) return;

            const now = new Date();
            const currentMins = now.getHours() * 60 + now.getMinutes();

            // Parse Fajr time (AM)
            const [fajrH, fajrM] = todayData.fajr.split(':').map(Number);
            const fajrMins = fajrH * 60 + fajrM;

            // Parse Maghrib time (PM)
            const [magH, magM] = todayData.maghrib.split(':').map(Number);
            const maghribHour24 = magH < 12 ? magH + 12 : magH;
            const maghribMins = maghribHour24 * 60 + magM;

            const isDark = document.body.classList.contains('dark-mode');

            if (currentMins >= maghribMins && !isDark) {
                // After Maghrib - enable dark mode
                document.body.classList.add('dark-mode');
                document.querySelector('.dark-mode-toggle').textContent = '\u2600\uFE0F';
                localStorage.setItem('darkMode', 'true');
            } else if (currentMins >= fajrMins && currentMins < maghribMins && isDark) {
                // Between Fajr and Maghrib - disable dark mode
                document.body.classList.remove('dark-mode');
                document.querySelector('.dark-mode-toggle').textContent = '\uD83C\uDF19';
                localStorage.setItem('darkMode', 'false');
            }
        }

        // Wrap toggleDarkMode to detect manual toggles and disable auto-dark
        const origToggleDarkMode = window.toggleDarkMode;
        window.toggleDarkMode = function() {
            // Manual toggle disables auto-dark
            localStorage.setItem(AUTO_DARK_KEY, 'false');
            origToggleDarkMode();
        };

        document.addEventListener('DOMContentLoaded', () => {
            // Check on load (small delay to let other init finish)
            setTimeout(checkAutoDark, 500);
            // Check every 60 seconds
            setInterval(checkAutoDark, 60000);
        });
    })();
    </script>


    <!-- Feature 7: Qibla Compass -->
    <script>
    (function() {
        const QIBLA_BEARING = 119.7; // degrees from North for Bradford
        let orientationWatching = false;

        window.openQibla = function() {
            document.getElementById('qiblaOverlay').classList.add('open');
            startOrientation();
        };

        window.closeQibla = function() {
            document.getElementById('qiblaOverlay').classList.remove('open');
        };

        window.closeQiblaOverlay = function(e) {
            if (e.target === document.getElementById('qiblaOverlay')) {
                closeQibla();
            }
        };

        function startOrientation() {
            if (orientationWatching) return;

            // Check for iOS permission
            if (typeof DeviceOrientationEvent !== 'undefined' &&
                typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(function(state) {
                    if (state === 'granted') {
                        window.addEventListener('deviceorientationabsolute', handleOrientation, true);
                        window.addEventListener('deviceorientation', handleOrientation, true);
                        orientationWatching = true;
                    }
                }).catch(function() {
                    showStaticBearing();
                });
            } else if ('DeviceOrientationEvent' in window) {
                window.addEventListener('deviceorientationabsolute', handleOrientation, true);
                window.addEventListener('deviceorientation', handleOrientation, true);
                orientationWatching = true;

                // If no event fires after 1 second, show static
                setTimeout(function() {
                    if (!orientationWatching || !window._orientationReceived) {
                        showStaticBearing();
                    }
                }, 1500);
            } else {
                showStaticBearing();
            }
        }

        window._orientationReceived = false;

        function handleOrientation(event) {
            window._orientationReceived = true;
            let heading = null;

            if (event.webkitCompassHeading !== undefined) {
                heading = event.webkitCompassHeading; // iOS
            } else if (event.alpha !== null) {
                heading = event.absolute ? (360 - event.alpha) : event.alpha;
            }

            if (heading !== null) {
                // Rotate compass so Qibla arrow always points correctly
                const arrow = document.getElementById('qiblaArrow');
                const kaaba = document.getElementById('qiblaKaaba');
                const ring = document.getElementById('qiblaSvg');

                if (ring) {
                    // Rotate the whole compass opposite to device heading, keeping Qibla arrow fixed at QIBLA_BEARING
                    ring.style.transform = 'rotate(' + (-heading) + 'deg)';
                    ring.style.transition = 'transform 0.3s ease-out';
                }

                const bearingText = document.getElementById('qiblaBearingText');
                if (bearingText) {
                    const relBearing = ((QIBLA_BEARING - heading) % 360 + 360) % 360;
                    bearingText.textContent = 'Qibla: ' + Math.round(relBearing) + '\u00B0 from you';
                }
            }
        }

        function showStaticBearing() {
            const bearingText = document.getElementById('qiblaBearingText');
            if (bearingText) {
                bearingText.textContent = 'Qibla is 119.7\u00B0 from North (ESE)';
            }
        }
    })();
    </script>
</body>
</html>
